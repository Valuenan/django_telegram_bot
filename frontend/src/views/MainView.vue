<template>
    <div class="telegram-app_telegram_app__6iz4V" style="margin-left: 10px;"> <!-- box low -->
        <div class="stack-navigation_screen___5WKf screen-0">
            <div class="tab-bar-screen_tab_bar_screen__kkfEZ" style="--tab-bar-height: 49px;">
                <div class="tab-bar-screen_container__PsZlI">
                    <div class="tab-bar-screen_screen__y4lze tab-bar-screen_active__pBXjN tab-home">
                        <div class="stack-navigation_screen___5WKf screen-0">
                            <div class="favorites-screen_favorites_screen__SSbmT"> <!-- box low -->
                                <div class="home-screen_wrapper__3Ji45"> <!-- box upper -->
                                    <!--                                    <div class="catalog-search_catalog_search__ocOev home-screen_catalog_search_seaction__qMHy9">-->
                                    <!--                                        &lt;!&ndash; search box &ndash;&gt;-->
                                    <!--                                        <div class="catalog-search_input__knGRA"> &lt;!&ndash; search box &ndash;&gt;-->
                                    <!--                                            <div class="catalog-search_icon__MZm8m">-->
                                    <!--                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"-->
                                    <!--                                                     viewBox="0 0 24 24" fill="none" stroke="currentColor"-->
                                    <!--                                                     stroke-width="1.5" stroke-linecap="round"-->
                                    <!--                                                     stroke-linejoin="round"-->
                                    <!--                                                     class="tabler-icon tabler-icon-search ">-->
                                    <!--                                                    <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path>-->
                                    <!--                                                    <path d="M21 21l-6 -6"></path>-->
                                    <!--                                                </svg>-->
                                    <!--                                            </div>-->
                                    <!--                                            <input placeholder="Найти в Ottuda"></div>-->
                                    <!--                                    </div>-->
                                    <div class="actions_actions__Krnjv">
                                        <div class="actions_wrapper__dOu19">
                                            <div class="actions_column__Rl3CY">
                                                <div class="actions_card__etbMU actions_calculate_card__CPhrn">
                                                    <div @click="ordersLink()" class="actions_inner__woSPI">
                                                        <div class="actions_head__nPU_x">
                                                            <div class="actions_title__Z_UU4">Ваши заказы</div>
                                                        </div>
                                                        <div class="actions_footer__I9ld4">
                                                            <div class="actions_icon_box__0CtMZ">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                     fill="none"
                                                                     viewBox="0 0 20 20" width="1em"
                                                                     height="1em">
                                                                    <path stroke="currentColor"
                                                                          stroke-linecap="round"
                                                                          stroke-linejoin="round"
                                                                          stroke-width="2"
                                                                          d="M4.167 10h11.666m0 0-5 5m5-5-5-5"></path>
                                                                </svg>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="actions_column__Rl3CY">
                                                <div class="actions_card__etbMU actions_choose_on_site_card__UFMpb">
                                                    <div class="actions_inner__woSPI" style="padding:0">
                                                        <div class="actions_head__nPU_x" style="justify-content:center">
                                                            <img src="http://localhost:8000/media/bot_messages/logo.jpg"
                                                                 width="148px">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!--                                                <div class="actions_card__etbMU actions_point_card__KtjiI">-->
                                                <!--                                                    <div class="actions_card_background__bvmVu">-->
                                                <!--                                                        <div class="actions_inner__woSPI">-->
                                                <!--                                                            <div class="actions_head__nPU_x">-->
                                                <!--                                                                <div class="actions_title__Z_UU4">Баллы</div>-->
                                                <!--                                                                <svg xmlns="http://www.w3.org/2000/svg"-->
                                                <!--                                                                     fill="none"-->
                                                <!--                                                                     viewBox="0 0 23 23" width="1em"-->
                                                <!--                                                                     height="1em">-->
                                                <!--                                                                    <path stroke="url(#a)"-->
                                                <!--                                                                          stroke-linecap="round"-->
                                                <!--                                                                          stroke-linejoin="round"-->
                                                <!--                                                                          stroke-width="2"-->
                                                <!--                                                                          d="m8.625 5.75 5.75 5.75-5.75 5.75"></path>-->
                                                <!--                                                                    <defs>-->
                                                <!--                                                                        <radialGradient id="a" cx="0" cy="0"-->
                                                <!--                                                                                        r="1"-->
                                                <!--                                                                                        gradientTransform="matrix(89.99998 2 -1.61598 72.71905 -53 -.5)"-->
                                                <!--                                                                                        gradientUnits="userSpaceOnUse">-->
                                                <!--                                                                            <stop stop-color="#EB9C00"></stop>-->
                                                <!--                                                                            <stop offset="0.271"-->
                                                <!--                                                                                  stop-color="#FF4769"></stop>-->
                                                <!--                                                                            <stop offset="0.664"-->
                                                <!--                                                                                  stop-color="#3D50FF"></stop>-->
                                                <!--                                                                            <stop offset="1"-->
                                                <!--                                                                                  stop-color="#00B3FF"></stop>-->
                                                <!--                                                                        </radialGradient>-->
                                                <!--                                                                    </defs>-->
                                                <!--                                                                </svg>-->
                                                <!--                                                            </div>-->
                                                <!--                                                            <div class="actions_footer__I9ld4">-->
                                                <!--                                                                <div class="points-icon_points_icon__1r6TU actions_points_icon__S8yNe">-->
                                                <!--                                                                    ₽-->
                                                <!--                                                                </div>-->
                                                <!--                                                                <div class="actions_points_num__aWMxL">0</div>-->
                                                <!--                                                            </div>-->
                                                <!--                                                        </div>-->
                                                <!--                                                    </div>-->
                                                <!--                                                </div>-->
                                            </div>
                                        </div>
                                    </div>
                                    <template v-for="message in info">
                                        <div class="product-horizontal-list_header__kQNss">
                                            <div class="product-horizontal-list_info__FVjM3">
                                                <div class="product-horizontal-list_title__d4p_N">{{ message.title }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="bot-text">
                                            <p>{{ message.text }}</p>
                                        </div>
                                        <div v-if="message.image" class="bot-image-wrapper">
                                            <img :src="message.image" class="bot-image" alt="{{ message.title }}">
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script>
import { useAuthStore, getCSRFToken } from '../users/auth.js'
import { useRouter } from 'vue-router'

import jsonData from '../response.json' // Import the data



export default {
    name: 'MainView',
    data() {
        return {
            user: {
                user_id: '',
                user_data: ''
            },
            info: {},
        }
    },
    setup() {
        const authStore = useAuthStore();
        const router = useRouter();


        return {
            authStore,
            router,
        }
    },

    async created() {
        await this.fetchProfile();
        await this.fetchMainMessage();
    },

    methods: {
        async fetchProfile() {
            try {
                // jsonData window.Telegram.WebApp.initDataUnsafe?.user
                const tg_user = jsonData
                this.user.user_id = tg_user.user.id
                // const response = await fetch(`https://refactored-fishstick-jj7qgwww9x94cq4r6-8000.app.github.dev/api/main/${tg_user.id}`)
                // const data = await response.json()

                const response = await fetch(`http://localhost:8000/api/profile/${this.user.user_id}`)
                this.user.user_data = await response.json()
                console.log(this.user)

              } catch (error) {
                console.log(error);
            }
        },

        async fetchMainMessage() {
            try {
                const response = await fetch(`http://localhost:8000/api/main-messages/`)
                this.info = await response.json()
                console.log(this.info)

              } catch (error) {
                console.log(error);
            }
        },

        async ordersLink() {
            this.$router.push({
            path: '/orders_history'
            });
        },

    }
}
</script>
